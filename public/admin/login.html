<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Admin Login - Daniel Hipskind</title>
    <link rel="stylesheet" href="/admin/admin-framework.css" />
    <style>
      /* Login-specific styles */
      .login-container {
        max-width: 450px;
        margin: 10vh auto;
        background: var(--admin-card-bg);
        backdrop-filter: var(--admin-glass-blur);
        -webkit-backdrop-filter: var(--admin-glass-blur);
        border: 1px solid var(--admin-glass-border);
        border-radius: var(--admin-radius-xl);
        box-shadow: var(--admin-glass-shadow);
        padding: var(--admin-space-xl);
      }

      .login-header {
        text-align: center;
        margin-bottom: var(--admin-space-xl);
      }

      .login-header h1 {
        font-size: var(--admin-font-2xl);
        font-weight: 700;
        margin: 0 0 var(--admin-space-sm) 0;
        background: linear-gradient(
          120deg,
          var(--admin-primary),
          var(--admin-accent)
        );
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
      }

      .login-header p {
        color: var(--admin-text-secondary);
        margin: 0;
        font-size: var(--admin-font-md);
      }

      .auth-methods {
        margin-top: var(--admin-space-lg);
        padding-top: var(--admin-space-lg);
        border-top: 1px solid var(--admin-border);
      }

      .auth-methods h3 {
        margin: 0 0 var(--admin-space-md) 0;
        font-size: var(--admin-font-lg);
        color: var(--admin-text);
      }

      .auth-method {
        margin-bottom: var(--admin-space-sm);
        padding: var(--admin-space-md);
        background: var(--admin-primary-light);
        border-radius: var(--admin-radius-md);
        font-size: var(--admin-font-sm);
        color: var(--admin-text-secondary);
      }

      .footer-links {
        text-align: center;
        margin-top: var(--admin-space-lg);
        padding-top: var(--admin-space-md);
        border-top: 1px solid var(--admin-border);
      }

      .footer-links a {
        color: var(--admin-primary);
        text-decoration: none;
        font-size: var(--admin-font-sm);
        transition: var(--admin-transition-fast);
      }

      .footer-links a:hover {
        color: var(--admin-primary-hover);
        text-decoration: underline;
      }
    </style>
  </head>
  <body class="admin-body">
    <div class="login-container">
      <div class="login-header">
        <h1>üîê Admin Login</h1>
        <p>Access to analytics and administrative tools</p>
      </div>

      <div id="alert-container"></div>

      <form id="login-form">
        <div class="admin-form-group">
          <label for="admin-secret" class="admin-form-label"
            >Admin Secret:</label
          >
          <input
            type="password"
            id="admin-secret"
            name="admin-secret"
            class="admin-form-input"
            placeholder="Enter your admin secret"
            required
          />
        </div>

        <button
          type="submit"
          class="admin-btn admin-btn-lg"
          id="login-btn"
          style="width: 100%; margin-bottom: var(--admin-space-md)"
        >
          <span id="login-text">Login to Dashboard</span>
        </button>
      </form>

      <div class="auth-methods">
        <h3>Authentication Methods:</h3>
        <div class="auth-method">
          <strong>Admin Secret:</strong> Use your admin secret token for API
          access
        </div>
        <div class="auth-method">
          <strong>Session Login:</strong> Creates a secure session cookie
          (requires Redis)
        </div>
      </div>

      <div class="footer-links">
        <a href="/admin/index.html">‚Üê Admin Dashboard</a>
        <span
          style="
            margin: 0 var(--admin-space-sm);
            color: var(--admin-text-light);
          "
          >|</span
        >
        <a href="/">‚Üê Back to Main Site</a>
      </div>
    </div>

    <script>
      const form = document.getElementById('login-form');
      const alertContainer = document.getElementById('alert-container');
      const loginBtn = document.getElementById('login-btn');
      const loginText = document.getElementById('login-text');
      const adminSecretInput = document.getElementById('admin-secret');

      // Enhanced alert styling using framework classes
      function showAlert(message, type = 'error') {
        const alertClass =
          type === 'success'
            ? 'admin-text-success'
            : type === 'info'
            ? 'admin-text-info'
            : 'admin-text-error';
        const bgClass =
          type === 'success'
            ? 'admin-bg-success'
            : type === 'info'
            ? 'admin-bg-info'
            : 'admin-bg-error';

        alertContainer.innerHTML = `
          <div style="padding: var(--admin-space-md); border-radius: var(--admin-radius-md); margin-bottom: var(--admin-space-md);
                      background: var(--status-${
                        type === 'error' ? 'error' : type
                      });
                      color: white; font-size: var(--admin-font-sm);">
            ${message}
          </div>`;

        setTimeout(() => {
          alertContainer.innerHTML = '';
        }, 5000);
      }

      // Enhanced loading state with framework styling
      function setLoading(loading) {
        loginBtn.disabled = loading;
        if (loading) {
          loginText.innerHTML =
            '<span class="admin-loading"></span>Authenticating...';
          loginBtn.style.opacity = '0.7';
        } else {
          loginText.textContent = 'Login to Dashboard';
          loginBtn.style.opacity = '1';
        }
      }

      // Enhanced form submission
      form.addEventListener('submit', async (e) => {
        e.preventDefault();

        const secret = adminSecretInput.value.trim();
        if (!secret) {
          showAlert('Please enter your admin secret');
          return;
        }

        setLoading(true);

        try {
          // Try session-based login first
          const response = await fetch('/api/admin/login', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify({ secret }),
            credentials: 'include',
          });

          if (response.status === 204) {
            showAlert(
              '‚úÖ Login successful! Redirecting to admin dashboard...',
              'success'
            );
            // Store token in sessionStorage for API calls
            sessionStorage.setItem('admin_token', 'cookie');
            setTimeout(() => {
              window.location.href = '/admin/index.html';
            }, 1000);
          } else if (response.status === 401) {
            showAlert(
              '‚ùå Invalid admin secret. Please check your credentials.'
            );
          } else if (response.status === 403) {
            showAlert('üö´ Admin login is not enabled on this server.');
          } else if (response.status === 503) {
            showAlert(
              '‚ö†Ô∏è Session store unavailable. Using token mode...',
              'info'
            );
            // Store the token for direct API use
            sessionStorage.setItem('admin_token', secret);
            setTimeout(() => {
              window.location.href = '/admin/index.html';
            }, 1000);
          } else {
            const errorData = await response.json().catch(() => ({}));
            showAlert(
              errorData.error || `‚ùå Login failed (${response.status})`
            );
          }
        } catch (error) {
          console.error('Login error:', error);
          showAlert(
            'üåê Network error. Please check your connection and try again.'
          );
        } finally {
          setLoading(false);
        }
      });

      // Check if already logged in
      document.addEventListener('DOMContentLoaded', () => {
        const existingToken = sessionStorage.getItem('admin_token');
        if (existingToken) {
          showAlert(
            '‚ÑπÔ∏è You appear to be already logged in. Redirecting...',
            'info'
          );
          setTimeout(() => {
            window.location.href = '/admin/index.html';
          }, 1500);
        }
      });
    </script>
  </body>
</html>
