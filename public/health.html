<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>System Health - Daniel Hipskind</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto,
          sans-serif;
        line-height: 1.6;
        color: #333;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        padding: 20px;
      }

      .container {
        max-width: 800px;
        margin: 0 auto;
        background: white;
        border-radius: 12px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        overflow: hidden;
      }

      .header {
        background: linear-gradient(45deg, #2d3748, #4a5568);
        color: white;
        padding: 30px;
        text-align: center;
      }

      .header h1 {
        font-size: 2rem;
        margin-bottom: 10px;
      }

      .header p {
        opacity: 0.9;
        font-size: 1.1rem;
      }

      .content {
        padding: 30px;
      }

      .health-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
      }

      .health-card {
        background: #f7fafc;
        border: 1px solid #e2e8f0;
        border-radius: 8px;
        padding: 20px;
        transition: transform 0.2s, box-shadow 0.2s;
      }

      .health-card:hover {
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
      }

      .health-card h3 {
        color: #2d3748;
        margin-bottom: 10px;
        font-size: 1.1rem;
      }

      .health-value {
        font-size: 1.5rem;
        font-weight: bold;
        margin-bottom: 5px;
      }

      .health-value.ok {
        color: #48bb78;
      }

      .health-value.error {
        color: #f56565;
      }

      .health-label {
        color: #718096;
        font-size: 0.9rem;
      }

      .refresh-btn {
        background: linear-gradient(45deg, #667eea, #764ba2);
        color: white;
        border: none;
        padding: 12px 24px;
        border-radius: 6px;
        cursor: pointer;
        font-size: 1rem;
        transition: transform 0.2s;
        margin-bottom: 20px;
      }

      .refresh-btn:hover {
        transform: translateY(-1px);
      }

      .refresh-btn:disabled {
        opacity: 0.6;
        cursor: not-allowed;
      }

      .loading {
        text-align: center;
        padding: 40px;
        color: #718096;
      }

      .error {
        background: #fed7d7;
        color: #c53030;
        padding: 15px;
        border-radius: 6px;
        margin-bottom: 20px;
      }

      .last-updated {
        text-align: center;
        color: #718096;
        font-size: 0.9rem;
        padding: 20px;
        border-top: 1px solid #e2e8f0;
        background: #f7fafc;
      }

      .nav-links {
        text-align: center;
        padding: 20px 30px;
        background: #f7fafc;
        border-bottom: 1px solid #e2e8f0;
      }

      .nav-links a {
        color: #667eea;
        text-decoration: none;
        font-weight: 500;
        transition: color 0.2s;
      }

      .nav-links a:hover {
        color: #764ba2;
      }

      .nav-separator {
        margin: 0 1rem;
        color: #cbd5e0;
      }

      @media (max-width: 600px) {
        .health-grid {
          grid-template-columns: 1fr;
        }

        .header h1 {
          font-size: 1.5rem;
        }

        .container {
          margin: 10px;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="header">
        <h1>System Health Dashboard</h1>
        <p>Real-time server status and performance metrics</p>
      </div>

      <div class="nav-links">
        <a href="/admin/analytics.html">üìä Analytics Dashboard</a>
        <span class="nav-separator">|</span>
        <a href="/admin/index.html">‚öôÔ∏è Admin Dashboard</a>
        <span class="nav-separator">|</span>
        <a href="/">üè† Main Site</a>
      </div>

      <div class="content">
        <button class="refresh-btn" onclick="loadHealthData()">
          üîÑ Refresh Data
        </button>

        <div id="error-message" class="error" style="display: none"></div>

        <div id="loading" class="loading">Loading health data...</div>

        <div id="health-data" style="display: none">
          <div class="health-grid">
            <div class="health-card">
              <h3>System Status</h3>
              <div class="health-value ok" id="status">-</div>
              <div class="health-label">Overall health</div>
            </div>

            <div class="health-card">
              <h3>Environment</h3>
              <div class="health-value" id="environment">-</div>
              <div class="health-label">Runtime environment</div>
            </div>

            <div class="health-card">
              <h3>Uptime</h3>
              <div class="health-value" id="uptime">-</div>
              <div class="health-label">Server running for</div>
            </div>

            <div class="health-card">
              <h3>Port</h3>
              <div class="health-value" id="port">-</div>
              <div class="health-label">Service port</div>
            </div>

            <div class="health-card">
              <h3>API Status</h3>
              <div class="health-value" id="api-status">-</div>
              <div class="health-label">API connectivity</div>
            </div>

            <div class="health-card">
              <h3>GitHub Token</h3>
              <div class="health-value" id="github-token">-</div>
              <div class="health-label">GitHub API access</div>
            </div>
          </div>
        </div>
      </div>

      <div class="last-updated">
        Last updated: <span id="last-updated">-</span>
      </div>
    </div>

    <script>
      function formatUptime(seconds) {
        const days = Math.floor(seconds / 86400);
        const hours = Math.floor((seconds % 86400) / 3600);
        const minutes = Math.floor((seconds % 3600) / 60);

        if (days > 0) {
          return `${days}d ${hours}h ${minutes}m`;
        } else if (hours > 0) {
          return `${hours}h ${minutes}m`;
        } else {
          return `${minutes}m`;
        }
      }

      async function loadHealthData() {
        const refreshBtn = document.querySelector('.refresh-btn');
        const loading = document.getElementById('loading');
        const healthData = document.getElementById('health-data');
        const errorMessage = document.getElementById('error-message');

        refreshBtn.disabled = true;
        refreshBtn.textContent = 'üîÑ Loading...';
        loading.style.display = 'block';
        healthData.style.display = 'none';
        errorMessage.style.display = 'none';

        try {
          // Load health data
          const [healthResponse, statusResponse] = await Promise.all([
            fetch('/health'),
            fetch('/api/status'),
          ]);

          if (!healthResponse.ok || !statusResponse.ok) {
            throw new Error(
              `HTTP ${healthResponse.status || statusResponse.status}`
            );
          }

          const healthData = await healthResponse.json();
          const statusData = await statusResponse.json();

          // Update UI
          document.getElementById('status').textContent =
            healthData.status.toUpperCase();
          document.getElementById('status').className = `health-value ${
            healthData.status === 'ok' ? 'ok' : 'error'
          }`;

          document.getElementById('environment').textContent =
            healthData.environment;
          document.getElementById('uptime').textContent = formatUptime(
            Math.floor(healthData.uptime)
          );
          document.getElementById('port').textContent = healthData.port;

          document.getElementById('api-status').textContent =
            statusData.api.toUpperCase();
          document.getElementById('api-status').className = `health-value ${
            statusData.api === 'online' ? 'ok' : 'error'
          }`;

          document.getElementById('github-token').textContent =
            statusData.github_token ? 'CONFIGURED' : 'MISSING';
          document.getElementById('github-token').className = `health-value ${
            statusData.github_token ? 'ok' : 'error'
          }`;

          document.getElementById('last-updated').textContent =
            new Date().toLocaleString();

          loading.style.display = 'none';
          document.getElementById('health-data').style.display = 'block';
        } catch (error) {
          console.error('Error loading health data:', error);
          errorMessage.textContent = `Failed to load health data: ${error.message}`;
          errorMessage.style.display = 'block';
          loading.style.display = 'none';
        } finally {
          refreshBtn.disabled = false;
          refreshBtn.textContent = 'üîÑ Refresh Data';
        }
      }

      // Load data on page load
      document.addEventListener('DOMContentLoaded', loadHealthData);

      // Auto-refresh every 30 seconds
      setInterval(loadHealthData, 30000);
    </script>
  </body>
</html>
